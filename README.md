# üìä Video Analytics AI Bot

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—á–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã.


# üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (Docker)

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —Ç–æ–ª—å–∫–æ Docker –∏ Docker Compose.
–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/koleslena/video_analytics_bot
cd video_analytics_bot
```

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Telegram
TOKEN=–í–ê–®_–¢–û–ö–ï–ù_–û–¢_BOTFATHER

# LLM (OpenRouter / OpenAI)
OPENAI_API_KEY=–í–ê–®_–ö–õ–Æ–ß_–û–¢_OPENROUTER
OPENAI_BASE_URL=https://openrouter.ai/api/v1 –∏–ª–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –±–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
MODEL_NAME=google/gemma-2-9b-it:free
PROMT_PATH=promt.txt

# Database (PostgreSQL)
DB_NAME=analytics_db
DB_USER=postgres
DB_PASSWORD=secret_password
DB_HOST=db
DB_PORT=5432

# Database init
JSON_URL=URL to videos.json
SCHEMA_PATH=init.sql
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:
```bash
docker-compose up --build -d
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:

–û—Ç–∫—Ä–æ–π—Ç–µ Telegram, –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ: –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ –≤ —Å–∏—Å—Ç–µ–º–µ?


# üõ† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ–¥—Ö–æ–¥

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ —Å—Ç–µ–∫–µ Python 3.11 + aiogram 3.x + psycopg3.

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã (Text-to-SQL)

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ–±—É—á–∞—Ç—å –Ω–µ–π—Ä–æ—Å–µ—Ç—å –Ω–∞ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (—á—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –¥–æ—Ä–æ–≥–æ), –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Text-to-SQL:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã—Ä–æ—Å–ª–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –≤—á–µ—Ä–∞?").

LLM Service –ø–æ–ª—É—á–∞–µ—Ç –≤–æ–ø—Ä–æ—Å –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü –∏ –ø—Ä–∞–≤–∏–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL.

LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–∏—Å—Ç—ã–π SQL-–∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: SELECT SUM(delta_views_count) FROM video_snapshots WHERE date(created_at) = CURRENT_DATE - 1;).

Database Service –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –≤ —Ä–µ–∂–∏–º–µ ReadOnly.

–ë–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑ –±–∞–∑—ã —á–∏—Å–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–ª—é—á–µ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü:

* videos: –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, –ª–∞–π–∫–æ–≤ –∏ —Ç.–¥.).
* video_snapshots: –ü–æ—á–∞—Å–æ–≤—ã–µ –∑–∞–º–µ—Ä—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç delta (–ø—Ä–∏—Ä–æ—Å—Ç) ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ—Ç—É —Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ª—é–±—ã–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã.


# üß† –û–ø–∏—Å–∞–Ω–∏–µ Prompt-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞

–î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ SQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (—Ñ–∞–π–ª promt.txt).

–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–º–ø—Ç–∞:

* –û–ø–∏—Å–∞–Ω–∏–µ DDL: –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º –º–æ–¥–µ–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–≤—è–∑–∏.
* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º: –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Ñ—Ä–∞–∑—ã "–≤—á–µ—Ä–∞", "–≤ –ø—Ä–æ—à–ª–æ–º –º–µ—Å—è—Ü–µ", "28 –Ω–æ—è–±—Ä—è" –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã YYYY-MM-DD.
* –õ–æ–≥–∏–∫–∞ –¥–µ–ª—å—Ç: –ü—Ä–æ–º–ø—Ç –æ–±—ä—è—Å–Ω—è–µ—Ç, —á—Ç–æ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ "–ø—Ä–∏—Ä–æ—Å—Ç–µ" –Ω—É–∂–Ω–æ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ delta_, –∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ "—Ñ–∏–Ω–∞–ª—å–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ" ‚Äî –±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ª—é–±—ã—Ö –∫–æ–º–∞–Ω–¥, –∫—Ä–æ–º–µ SELECT.

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞:
"–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ SQL. –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –≤ SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ PostgreSQL. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–∞–±–ª–∏—Ü—É videos –¥–ª—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ video_snapshots –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ –ø—Ä–∏—Ä–æ—Å—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–ª–æ–Ω–∫–∏ delta_views_count..."


# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* ReadOnly Access: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å —Ñ–ª–∞–≥–æ–º SET TRANSACTION READ ONLY. –î–∞–∂–µ –µ—Å–ª–∏ LLM —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç DROP TABLE, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–∏—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å.
* Env Variables: –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ.
* SQL Validation: –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –æ—Ç–≤–µ—Ç LLM –æ—Ç Markdown-—Ä–∞–∑–º–µ—Ç–∫–∏ –∏ –ª–∏—à–Ω–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –ë–î.


# üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
–°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã (init.sql).
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞, –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ json —Ñ–∞–π–ª–∞, –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∏–∑ —Å–µ—Ç–∏.


–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: [@koleslena]
–í–µ—Ä—Å–∏—è: 1.0.0 (–§–µ–≤—Ä–∞–ª—å 2026)

